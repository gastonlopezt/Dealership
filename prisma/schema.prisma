// Prisma schema for the dealership project using MySQL
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
}

enum VehicleStatus {
  ACTIVE
  SOLD
  DRAFT
  PAUSED
}

model User {
  id          String      @id @default(cuid())
  email       String      @unique
  passwordHash String
  name        String?
  role        Role        @default(ADMIN)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Vehicle {
  id          String         @id @default(cuid())
  type        VehicleType?
  make        String
  model       String
  year        Int
  price       Decimal        @db.Decimal(10, 2)
  mileage     Int
  location    String
  description String?
  status      VehicleStatus  @default(ACTIVE)
  photos      VehiclePhoto[]
  leads       Lead[]
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([make, model, year])
  @@index([price])
  @@index([mileage])
  @@index([location])
  @@index([type])
}

model VehiclePhoto {
  id        String   @id @default(cuid())
  vehicleId String
  vehicle   Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  publicId  String   // Cloudinary public_id
  url       String
  width     Int?
  height    Int?
  position  Int      @default(0)
  createdAt DateTime @default(now())
}

model Lead {
  id        String   @id @default(cuid())
  vehicleId String
  vehicle   Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  name      String
  email     String?
  phone     String?
  message   String?
  createdAt DateTime @default(now())

  @@index([vehicleId, createdAt])
}

enum VehicleType {
  SEDAN
  SUV
  PICKUP
  HATCHBACK
}
